(()=>{"use strict";function e(a,d,o){let n=document.getElementById("main"),i=document.createElement("div"),l=document.createElement("div"),s=!1,m=!1;const c=a.gameboard.size,p="rgb(64, 64, 64)",u=480/11,h={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2};function g(e){let t=window.getComputedStyle(e),r=t.width,a=t.height;e.style.width=a,e.style.height=r;let d=parseFloat(t.width),o=parseFloat(t.height),n=e.querySelectorAll(".ship-part");if(d<o){e.style.removeProperty("display");for(let e=0;e<n.length;e++)n[e].style.removeProperty("border"),n[e].style.border="1px solid "+p,e!=n.length-1&&n[e].style.removeProperty("border-bottom")}else{e.style.display="flex";for(let e=0;e<n.length;e++)n[e].style.removeProperty("border"),n[e].style.border="1px solid "+p,e!=n.length-1&&n[e].style.removeProperty("border-right")}}function f(){let e=document.querySelector(".board-container"),n=document.getElementById("player-board"),i=n.cloneNode(!0);n.remove(),e.append(i),r(a);for(let e=0;e<c;e++)for(let t=0;t<c;t++){let r=a.gameboardElement[e][t];if(r.classList.remove("board-space-setup"),r.firstElementChild){let d=r.firstElementChild,o=window.getComputedStyle(d),n=parseFloat(o.width)>parseFloat(o.height)?"right":"down";d.removeAttribute("draggable"),d.style.removeProperty("cursor"),a.gameboard.addShip(h[d.id],t,e,n),d.remove()}}let l=document.getElementById("ships-container"),s=document.getElementById("buttons-container");l.remove(),s.remove(),t(d),function(){for(const e in h){let t=!1,r=Math.floor(2*Math.random())?"down":"right";for(;!t;){let a=Math.floor(Math.random()*c),o=Math.floor(Math.random()*c);0!=d.gameboard.addShip(h[e],a,o,r)&&(t=!0)}}}(),r(d),o()}i.id="details",l.id="boards-container",n.innerHTML="",n.append(i,l),details.innerHTML="Setup board",function(){let e=document.createElement("div"),t=document.createElement("div"),r=document.createElement("div");e.id="ships-container",t.id="ships-header",r.id="ships-inventory",t.innerHTML="Ships";for(const e in h){let t=document.createElement("div"),a=document.createElement("div");t.classList.add("inventory-ship-container"),a.classList.add("inventory-ship"),a.id=e,a.style.display="flex",a.style.cursor="pointer",a.draggable="true";for(let t=0;t<h[e];t++){let r=document.createElement("div");r.classList.add("ship-part",e),r.style.width=u-1+"px",r.style.height=u-1+"px",r.style.border="1px solid "+p,t!=h[e]-1&&r.style.removeProperty("border-right"),a.append(r)}a.addEventListener("dragstart",(e=>{e.dataTransfer.setData("text",e.target.id)})),t.append(a),r.append(t)}e.append(t,r),l.append(e)}(),t(a),r(a),function(){let t=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),l=document.createElement("div"),p=document.createElement("div");t.id="buttons-container",r.classList.add("button"),r.innerHTML="Rotate",i.classList.add("button"),i.innerHTML="Autoplace",l.classList.add("button"),l.innerHTML="Reset",p.id="start-game-button",p.classList.add("button"),p.innerHTML="Start Game",r.addEventListener("click",(()=>{s=!s;let e=document.getElementById("ships-inventory"),t=document.querySelectorAll(".inventory-ship");"column"==window.getComputedStyle(e).flexDirection?e.style.flexDirection="row":e.style.flexDirection="column",t.forEach((e=>{g(e)}))})),i.addEventListener("click",(()=>{!function(){if(document.querySelectorAll(".inventory-ship").forEach((e=>{let t=!1;Math.floor(2*Math.random())&&g(e);let r=window.getComputedStyle(e),d=parseFloat(r.width),o=parseFloat(r.height);for(;!t;){let r=Math.floor(Math.random()*c),n=Math.floor(Math.random()*c);if(d>o){if(r<=c-h[e.id]){t=!0;for(let d=r;d<r+h[e.id];d++)4==a.gameboardElement[n][d].classList.length&&(t=!1);if(t)for(let t=r;t<r+h[e.id];t++)a.gameboardElement[n][t].classList.add(e.id)}}else if(n<=c-h[e.id]){t=!0;for(let d=n;d<n+h[e.id];d++)4==a.gameboardElement[d][r].classList.length&&(t=!1);if(t)for(let t=n;t<n+h[e.id];t++)a.gameboardElement[t][r].classList.add(e.id)}t&&(e.classList.remove("inventory-ship"),e.classList.add("board-ship-select"),a.gameboardElement[n][r].append(e))}})),0==m){let e=document.getElementById("start-game-button");e.id="start-game-ready-button",e.addEventListener("click",(()=>{f()})),m=!0}}()})),l.addEventListener("click",(()=>{e(a,d,o)})),t.append(r,i,l,p),n.append(t)}(),function(){let e=document.querySelectorAll(".board-space");for(let t=0;t<c;t++)for(let r=0;r<c;r++){let d=a.gameboardElement[t][r];d.classList.add("board-space-setup"),d.addEventListener("dragenter",(e=>{e.preventDefault()})),d.addEventListener("dragover",(e=>{e.preventDefault(),d.classList.add("board-space-hover")})),d.addEventListener("dragleave",(()=>{d.classList.remove("board-space-hover")})),d.addEventListener("drop",(o=>{let n=o.dataTransfer.getData("text"),i=document.getElementById(n),l=window.getComputedStyle(i),s=parseFloat(l.width),p=parseFloat(l.height),u=!1;if(o.preventDefault(),d.classList.remove("board-space-hover"),s>p){if(r<=c-h[i.id]){u=!0;for(let e=r;e<r+h[i.id];e++)4==a.gameboardElement[t][e].classList.length&&(u=!1);if(u){e.forEach((e=>{e.classList.remove(i.id)}));for(let e=r;e<r+h[i.id];e++)a.gameboardElement[t][e].classList.add(i.id)}}}else if(t<=c-h[i.id]){u=!0;for(let e=t;e<t+h[i.id];e++)4==a.gameboardElement[e][r].classList.length&&(u=!1);if(u){e.forEach((e=>{e.classList.remove(i.id)}));for(let e=t;e<t+h[i.id];e++)a.gameboardElement[e][r].classList.add(i.id)}}if(u&&(i.classList.remove("inventory-ship"),i.classList.add("board-ship-select"),o.target.append(i),0==document.querySelectorAll(".inventory-ship").length&&0==m)){let e=document.getElementById("start-game-button");e.id="start-game-ready-button",e.addEventListener("click",(()=>{f()})),m=!0}}))}}()}function t(e){let t=document.getElementById("main"),r=document.getElementById("boards-container");const a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],d="rgb(64, 64, 64)",o=e.gameboard.size+1,n=480/o;let i=document.createElement("div"),l=document.createElement("div"),s=document.createElement("div");i.classList.add("board-container"),l.classList.add("board-header"),"human"==e.getType()?(l.innerHTML="Player 1",s.id="player-board"):"ai"==e.getType()&&(l.innerHTML="Player 2",s.id="ai-board"),s.classList.add("board"),s.style.width="480px",s.style.height="480px",s.style.gridTemplateColumns="repeat("+o+", 1fr)",s.style.gridTemplateRows="repeat("+o+", 1fr)";for(let e=0;e<o;e++)for(let t=0;t<o;t++){let r=document.createElement("div");r.classList.add("square"),r.style.width=n-1+"px",r.style.height=n-1+"px",r.style.borderTop="1px solid "+d,r.style.borderLeft="1px solid "+d,t==o-1&&(r.style.borderRight="1px solid "+d),e==o-1&&(r.style.borderBottom="1px solid "+d),0==t||0==e?r.classList.add("column-row-header"):r.classList.add("board-space"),0!=t&&0==e&&(r.innerHTML=a[t-1]),0!=e&&0==t&&(r.innerHTML=e),s.append(r)}i.append(l,s),r.append(i),t.append(r)}function r(e){const t=new Array(e.gameboard.size);for(let r=0;r<e.gameboard.size;r++)t[r]=new Array(e.gameboard.size);let r;"human"==e.getType()?r=document.getElementById("player-board"):"ai"==e.getType()&&(r=document.getElementById("ai-board"));let a=r.querySelectorAll(".board-space"),d=0;for(let r=0;r<e.gameboard.size;r++)for(let o=0;o<e.gameboard.size;o++)t[r][o]=a[d],d++;e.gameboardElement=t}const a=(e,t)=>{const r=(()=>{const e=10,t=new Array(e);for(let r=0;r<e;r++)t[r]=new Array(e);const r=[],a=[],d=[],o=(r,a,d,o)=>{let n=1;if("left"!=o&&"up"!=o||(n=-1),"left"==o||"right"==o){for(let o=0;o<r;o++)if(a+o*n<0||a+o+n>=e||void 0!==t[d][a+o*n])return!1}else if("up"==o||"down"==o)for(let o=0;o<r;o++)if(d+o*n<0||d+o*n>=e||void 0!==t[d+o*n][a])return!1;return!0};return{size:e,board:t,ships:r,hit:a,missed:d,checkAdd:o,addShip:(e,a,d,n)=>{if(!o(e,a,d,n))return!1;let i=1;"left"!=n&&"up"!=n||(i=-1);const l=(e=>{const t=[];return{length:e,id:null,coords:t,hit:(r,a)=>{for(let d=0;d<e;d++)if(t[d].x==r&&t[d].y==a){t[d].hit=!0;break}},isSunk:()=>{let r=!0;for(let a=0;a<e;a++)if(!t[a].hit){r=!1;break}return r}}})(e);r.push(l);const s=r.indexOf(l);if(l.id=s,"left"==n||"right"==n)for(let r=0;r<e;r++)t[d][a+r*i]=s,l.coords.push({x:a+r*i,y:d,hit:!1});else if("up"==n||"down"==n)for(let r=0;r<e;r++)t[d+r*i][a]=s,l.coords.push({x:a,y:d+r*i,hit:!1})},receiveAttack:(e,o)=>{if(void 0!==t[o][e]){let d=t[o][e];r[d].hit(e,o),a.push({x:e,y:o})}else d.push({x:e,y:o})},checkShips:()=>{let e=!0;for(let t=0;t<r.length;t++)if(!r[t].isSunk()){e=!1;break}return e}}})(),a={};return{getName:()=>e,getType:()=>t,gameboard:r,gameboardElement:[],sendAttack:(e,r,d)=>{let o=document.getElementById("details");if("ai"==t){let t=!1,o=!1,n=!1,i={up:!1,right:!1,down:!1,left:!1};for(;!t;){if(t=!0,!n)for(let t=0;t<e.gameboard.hit.length;t++)e.gameboard.hit[t].x==a.x&&e.gameboard.hit[t].y==a.y&&(o=!0);if(o){let l=Math.floor(2*Math.random()),s=Math.floor(2*Math.random());s=s?1:-1,l?(r=a.x+1*s,d=a.y):(r=a.x,d=a.y+1*s),(r<0||r>e.gameboard.size-1||d<0||d>e.gameboard.size-1)&&(t=!1),l||-1!=s?l&&1==s?i.right=!0:l||1!=s?l&&-1==s&&(i.left=!0):i.down=!0:i.up,n=!0;for(const e in i)i[e]||(n=!1);n&&(o=!1)}else r=Math.floor(Math.random()*(e.gameboard.size-1)),d=Math.floor(Math.random()*(e.gameboard.size-1));for(let a=0;a<e.gameboard.hit.length;a++)e.gameboard.hit[a].x==r&&e.gameboard.hit[a].y==d&&(t=!1);for(let a=0;a<e.gameboard.missed.length;a++)e.gameboard.missed[a].x==r&&e.gameboard.missed[a].y==d&&(t=!1)}}e.gameboard.receiveAttack(r,d),o.innerHTML="Attacking Target: "+["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"][r]+(d+1)+"<br>",void 0!==e.gameboard.board[d][r]?(e.gameboardElement[d][r].innerHTML="O",e.gameboardElement[d][r].classList.add("hit"),o.innerHTML+="Target Hit!"):(e.gameboardElement[d][r].innerHTML="X",o.innerHTML+="Target Missed"),a.x=r,a.y=d}}},d=()=>{const t=a("Player 1","human"),d=a("Player 2","ai");let n=Math.floor(2*Math.random()),i=!1;const l=()=>{let e=document.getElementById("details"),a=n?t:d;e.innerHTML="Turn: "+a.getName(),a==t?function(e,t,a){for(let d=0;d<10;d++)for(let o=0;o<10;o++){let n=t.gameboardElement[d][o];t.gameboardElement[d][o].innerHTML||(n.addEventListener("mouseenter",(()=>{n.classList.add("board-space-hover"),n.style.cursor="pointer"})),n.addEventListener("mouseleave",(()=>{n.classList.remove("board-space-hover"),n.style.cursor="default"})),n.addEventListener("click",(()=>{n.classList.remove("board-space-hover"),n.style.cursor="default";let i=document.getElementById("ai-board"),l=i.cloneNode(!0);i.parentNode.replaceChild(l,i),r(t),e.sendAttack(t,o,d),a()})))}}(t,d,s):a==d&&setTimeout((()=>{d.sendAttack(t),s()}),500)},s=()=>{setTimeout((()=>{m(),i||(n=1-n,l())}),500)},m=()=>{let e=document.getElementById("details"),r=!0,a=!0;if([t,d].forEach((e=>{e.gameboard.ships.forEach((o=>{o.isSunk()||e!=t?o.isSunk()||e!=d||(r=!1):a=!1}))})),r?(e.innerHTML="You Win!",i=!0):a&&(e.innerHTML="You Lose!",i=!0),r||a){let e=document.createElement("div"),t=document.createElement("div");e.id="buttons-container",t.classList.add("button"),t.innerHTML="Play Again",t.addEventListener("click",(()=>{o()})),e.append(t),main.append(e)}};return{player:t,ai:d,newGame:()=>{e(t,d,l)},turn:l,endTurn:s,checkWin:m}};function o(){let e=document.getElementById("container"),t=document.createElement("div"),r=document.createElement("div");t.id="header",r.id="main",t.innerHTML="Battleship",e.innerHTML="",e.append(t,r),d().newGame()}o()})();